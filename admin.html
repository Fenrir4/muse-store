<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>MUSE Admin | –í—Ö—ñ–¥</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/base.css"> 
    <link rel="stylesheet" href="css/header.css"> 

    <style>
        body { 
            background: #fdfbfb; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh; 
            font-family: 'Montserrat', sans-serif; 
        }
        
        .admin-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 120px 20px 60px;
        }

        .admin-panel { 
            background: #fff; 
            padding: 40px; 
            border: 1px solid #eee;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            width: 100%; 
            max-width: 600px; 
        }
        
        .hidden { display: none !important; }
        
        h2 { 
            text-align: center; 
            margin-bottom: 30px; 
            color: var(--primary-color); 
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
        }

        input, textarea, select { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 20px; 
            border: 1px solid #ddd; 
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        label { 
            font-weight: 600; 
            font-size: 11px; 
            display: block; 
            margin-bottom: 8px; 
            text-transform: uppercase; 
            color: #888;
            letter-spacing: 1px;
        }

        /* –ß–µ–∫–±–æ–∫—Å–∏ –¥–ª—è —Ä–æ–∑–º—ñ—Ä—ñ–≤ */
        .sizes-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .size-checkbox-label {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            padding: 10px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 12px;
            font-weight: 600;
            color: #555;
        }

        .size-checkbox-label:hover { border-color: var(--accent-color); }

        /* –•–æ–≤–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —á–µ–∫–±–æ–∫—Å */
        .size-checkbox-label input { display: none; }

        /* –°—Ç–∏–ª—å –∫–æ–ª–∏ –≤–∏–±—Ä–∞–Ω–æ (JS –¥–æ–¥–∞—Å—Ç—å –∫–ª–∞—Å checked) */
        .size-checkbox-label.checked {
            background-color: var(--accent-color);
            color: #fff;
            border-color: var(--accent-color);
        }

        .btn-admin { 
            width: 100%; 
            padding: 15px; 
            background: var(--accent-color);
            color: #fff; 
            border: none; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-weight: 600; 
            letter-spacing: 1px;
            transition: 0.3s;
        }
        
        .btn-admin:hover { background: #5a222a; }
        
        .logout-btn { background: #333; margin-top: 15px; }
        .logout-btn:hover { background: #000; }

        .helper-text { font-size: 11px; color: #999; margin-top: -15px; margin-bottom: 15px; }
    </style>
</head>
<body>
    
    <header>
        <div class="logo"><a href="index.html" style="text-decoration: none; color: inherit;">MUSE</a></div>
        <nav>
            <ul class="nav-links">
                <li><a href="catalog.html" target="_blank">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç</a></li>
            </ul>
        </nav>
    </header>

    <div class="admin-wrapper">
        
        <div id="login-screen" class="admin-panel">
            <h2>–í—Ö—ñ–¥ –≤ –∞–¥–º—ñ–Ω–∫—É</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-admin" onclick="login()">–£–≤—ñ–π—Ç–∏</button>
        </div>

        <div id="admin-content" class="admin-panel hidden">
            <h2>–ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä</h2>
            <form id="product-form">
                
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label>ID —Ç–æ–≤–∞—Ä—É (–ß–∏—Å–ª–æ)</label>
                        <input type="number" id="p-id" placeholder="–ù–∞–ø—Ä: 101" required>
                    </div>
                    <div style="flex: 1;">
                        <label>–¶—ñ–Ω–∞ (UAH)</label>
                        <input type="number" id="p-price" placeholder="2800" required>
                    </div>
                </div>

                <label>–ë—Ä–µ–Ω–¥ / –ö–æ–ª–µ–∫—Ü—ñ—è</label>
                <input type="text" id="p-brand" placeholder="MUSE Collection" value="MUSE Collection">
                
                <label>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</label>
                <input type="text" id="p-title" placeholder="–®–æ–≤–∫–æ–≤–∞ —Å—É–∫–Ω—è –º–∞–∫—Å—ñ" required>
                
                <label>–§–æ—Ç–æ (URL –ø–æ—Å–∏–ª–∞–Ω–Ω—è)</label>
                <input type="text" id="p-img" placeholder="https://..." required>
                <p class="helper-text">–í—Å—Ç–∞–≤—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (jpg/png).</p>
                
                <label>–û–ø–∏—Å</label>
                <textarea id="p-desc" rows="4" placeholder="–ï–ª–µ–≥–∞–Ω—Ç–Ω–∞ —Å—É–∫–Ω—è –¥–ª—è –≤–µ—á—ñ—Ä–Ω—ñ—Ö –≤–∏—Ö–æ–¥—ñ–≤..."></textarea>
                
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label>–°–∫–ª–∞–¥ —Ç–∫–∞–Ω–∏–Ω–∏</label>
                        <input type="text" id="p-composition" placeholder="100% –®–æ–≤–∫">
                    </div>
                    <div style="flex: 1;">
                        <label>–ö–æ–ª—ñ—Ä</label>
                        <input type="text" id="p-color" placeholder="–ß–æ—Ä–Ω–∏–π">
                    </div>
                </div>

                <label>–î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏</label>
                <div class="sizes-grid">
                    <label class="size-checkbox-label"><input type="checkbox" value="XS"><span>XS</span></label>
                    <label class="size-checkbox-label"><input type="checkbox" value="S" checked><span>S</span></label>
                    <label class="size-checkbox-label"><input type="checkbox" value="M" checked><span>M</span></label>
                    <label class="size-checkbox-label"><input type="checkbox" value="L"><span>L</span></label>
                    <label class="size-checkbox-label"><input type="checkbox" value="XL"><span>XL</span></label>
                </div>
                
                <button type="button" class="btn-admin" onclick="saveProduct()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>
            </form>
            
            <button class="btn-admin logout-btn" onclick="logout()">–í–∏–π—Ç–∏</button>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script src="js/config.js"></script>

    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        firebase.initializeApp(CONFIG.firebase);
        const db = firebase.database();
        const auth = firebase.auth();

        // –õ–æ–≥—ñ–∫–∞ –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è —á–µ–∫–±–æ–∫—Å—ñ–≤
        document.querySelectorAll('.size-checkbox-label input').forEach(cb => {
            // –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            if(cb.checked) cb.parentElement.classList.add('checked');
            
            // –ü—Ä–∏ –∫–ª—ñ–∫—É
            cb.addEventListener('change', function() {
                if(this.checked) this.parentElement.classList.add('checked');
                else this.parentElement.classList.remove('checked');
            });
        });

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Ö–æ–¥—É
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('admin-content').classList.add('hidden');
            }
        });

        function login() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, pass)
                .catch(err => alert("–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: " + err.message));
        }

        function logout() {
            auth.signOut();
        }

        function saveProduct() {
            const id = document.getElementById('p-id').value;
            if(!id) return alert("–í–∫–∞–∂—ñ—Ç—å ID (—á–∏—Å–ª–æ)!");

            const price = parseInt(document.getElementById('p-price').value);
            if(!price) return alert("–í–∫–∞–∂—ñ—Ç—å —Ü—ñ–Ω—É!");

            // –ó–±–∏—Ä–∞—î–º–æ –≤–∏–±—Ä–∞–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏ –≤ –º–∞—Å–∏–≤ ['S', 'M']
            const selectedSizes = [];
            document.querySelectorAll('.size-checkbox-label input:checked').forEach(cb => {
                selectedSizes.push(cb.value);
            });

            if (selectedSizes.length === 0) {
                if(!confirm("–ù–µ –≤–∏–±—Ä–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É. –¢–æ–≤–∞—Ä –±—É–¥–µ 'One Size'. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?")) return;
            }
            
            // –§–æ—Ä–º—É—î–º–æ –æ–±'—î–∫—Ç –¥–ª—è MUSE
            const productData = {
                id: parseInt(id),
                brand: document.getElementById('p-brand').value,
                title: document.getElementById('p-title').value,
                price: price,
                image: document.getElementById('p-img').value,
                description: document.getElementById('p-desc').value,
                
                // –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ø–æ–ª—è –¥–ª—è –æ–¥—è–≥—É
                composition: document.getElementById('p-composition').value,
                color: document.getElementById('p-color').value,
                sizes: selectedSizes, 
                
                timestamp: Date.now()
            };

            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Firebase
            db.ref('products/' + id).set(productData)
                .then(() => {
                    alert("–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ! üëó");
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∏ (–∑–∞–ª–∏—à–∞—î–º–æ –±—Ä–µ–Ω–¥, –±–æ —á–∞—Å—Ç–æ –¥–æ–¥–∞—é—Ç—å –æ–¥–Ω—É –∫–æ–ª–µ–∫—Ü—ñ—é)
                    const brand = document.getElementById('p-brand').value;
                    document.getElementById('product-form').reset();
                    document.getElementById('p-brand').value = brand;
                    
                    // –°–∫–∏–¥–∞—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω—ñ —á–µ–∫–±–æ–∫—Å–∏
                    document.querySelectorAll('.size-checkbox-label').forEach(l => l.classList.remove('checked'));
                })
                .catch(err => alert("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Å—É: " + err.message));
        }
    </script>
</body>
</html>